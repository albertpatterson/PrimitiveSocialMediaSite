extends basePage.pug

block content
    div.row
        div#picture.col-sm-6
            img.picture(src=picSrc)
        div#personalInfo.col-sm-6
            p.nameText=name
            p.infoText Age: #{age}
            p.infoText Location: #{zip}
            p.infoText Business: #{business}
            if canInteract
                button#messageBtn.interactBtn.btn.btn-primary(data-toggle='collapse', data-target="#messageField") Message
                button#followBtn.interactBtn.btn.btn-primary Follow

    br
    div#messageField.collapse
        div.form-group
            label(for='messageTextarea') Message:
            textarea.form-control(id="messageTextarea", name="message", rows="5")
            button#sendMessage.btn.btn-primary.centered Send Message
    div.contentItem.row
        div.placeHolder100
    br
    div.ad.row
        div.placeHolder100
    br
    div.contentItem.row
        div.placeHolder100
    br
    div.contentItem.row
        div.placeHolder150
    br
    div.ad.row
        div.placeHolder100

    script.
        $(document).ready(function(){

            var followBtn = document.getElementById('followBtn');
            followBtn.onclick = function(){
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                    // Typical action to be performed when the document is ready:
                        alert("Updated following list!");
                    }
                };
                xhttp.open("GET", "/updateFollowingList?followeeName=#{name}", true);
                xhttp.send();
            } 

            var sendMessageBtn = $('#sendMessage');
            var messageTextarea = $('#messageTextarea');
            sendMessageBtn.click(function(){
                var message = messageTextarea.val();
                $.post(
                    "/postContent", 
                    {content: message, recipient: "!{name}"},
                    function(){
                        messageTextarea.val("");
                    })
            })            
        })
